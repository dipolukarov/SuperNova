var unit_selected=null;function eco_struc_make_resource_row(b,a){var f,d;var c=Math.ceilVal(b[a]);var e=$("#unit_"+a);if(c>0){if(STACKABLE){c*=Math.roundVal($("#unit_amount").val())}f=Math.roundVal(planet[a])-c;d=f+Math.floatVal(planet[a+"_incoming"]);e.css({visibility:"visible",display:"table-row"});elementPrettyNumber($("#"+a+"_price"),c,planet[a]);elementPrettyNumber($("#"+a+"_left"),f);if(planet.fleet_own){elementPrettyNumber($("#"+a+"_fleet"),d);jQuery("#fleet_res").css("display","block")}else{$("#"+a+"_fleet").css("display","none")}}else{e.css("visibility","hidden")}}function eco_struc_make_resource_rows_all(a){eco_struc_make_resource_row(a,"metal");eco_struc_make_resource_row(a,"crystal");eco_struc_make_resource_row(a,"deuterium");eco_struc_make_resource_row(a,"dark_matter")}function buildUnitProcessResult(b,a){if(a){$("[name=action]").val(a);$("#form_unit").submit()}else{b.preventDefault()}return !!a}jQuery(document).ready(function(a){$("#unit_create_button_auto").on("click",function(c){var b=elementIsEnabled(this);if(b){if(DARK_MATTER>=MARKET_AUTOCONVERT_COST){if(confirm(language.eco_bld_autoconvert_explain+language.eco_bld_autoconvert_confirm)){b="create_autoconvert"}}else{alert(language.eco_bld_autoconvert_explain+language.eco_bld_autoconvert_dark_matter_none);b=false}}return buildUnitProcessResult(c,b)});$(".unit_create").on("click",function(c){var b=elementIsEnabled(this)||$(this).hasClass("icon_plus")||$(this).hasClass("icon_minus");if(b){b=$(this).hasClass("unit_create")?"create":"destroy"}return buildUnitProcessResult(c,b)});$(".unit_destroy").on("click",function(b){return buildUnitProcessResult(b,"destroy")});$("#form_unit").on("keypress",function(c){if(13!=c.which){return true}var b=$("#unit_create_button");if(!b.is("[disabled]")){b.click()}c.preventDefault();return false});$("#unit_amount").on("change",function(){$("#unit_create_button").button(Math.intVal($("#unit_amount").val())?"enable":"disable")});jQuery("#unit_amount").on("keyup change",function(c,d){var b=Math.intVal($("#unit_id").val());eco_struc_make_resource_rows_all(production[b])});jQuery("#unit_table").on("mouseenter","div[unit_id]",function(b,c){eco_struc_show_unit_info(jQuery(this).attr("unit_id"))}).on("mouseleave","div[unit_id]",function(b,c){if(unit_selected!=jQuery(this).attr("unit_id")){jQuery(this).removeClass("unit_border_selected")}}).on("click","div[unit_id]",function(b,c){eco_struc_select_unit(jQuery(this).attr("unit_id"))});$("#unit_info_extra_switch").on("click",function(){var b=$("#unit_balance");if(b.is(":visible")){$(this).children().html(language.eco_bld_unit_info_extra_show);b.hide()}else{$(this).children().html(language.eco_bld_unit_info_extra_hide);b.show()}});$("#auto_convert").on("change",function(){var c=$("#unit_create, #unit_create *");var d=$("#unit_create_button");c.prop("disabled",true);d.button("disable");unit_id=$("#unit_id").val();var b=production[unit_id];$("#unit_max_number").html(sn_format_number(b.can_build));if(b.autoconvert_amount){$("#auto_convert").prop("disabled",false).not(":checkbox").button("enable")}if(b.build_can!=0&&b.build_result==0){c.prop("disabled",false);$("#unit_amountslide").slider({max:b.can_build})}if(!$("#auto_convert").is(":disabled")&&$("#auto_convert").attr("aria-disabled")!="true"&&$("#auto_convert").is(":checked")){c.prop("disabled",false);$("#unit_amountslide").slider({max:b.autoconvert_amount});$("#unit_max_number").html(sn_format_number(b.autoconvert_amount))}else{if(b.build_can==0||b.build_result!=0){c.prop("disabled",true);$("#unit_amountslide").slider({max:0,value:0});d.button("disable");$("#unit_amount").val(0)}}if(b.autoconvert_amount){$("#auto_convert").prop("disabled",false).not(":checkbox").button("enable")}$("#unit_amount").change()});if(!planet.fleet_own){jQuery("[hide_no_fleet]").hide()}production_id_first?eco_struc_show_unit_info(production_id_first,true):""});var bld_unit_info_width=0;function extracted(a,b){switch(a){case"level":b+='<th class="c_l">'+language.level_short+"</th>";break;case"sys_metal":case"sys_crystal":case"sys_deuterium":case"sys_energy":case"sys_expeditions":case"sys_colonies":b+='<th class="c_c" colspan="2">'+language[a];break;case"metal_diff":case"crystal_diff":case"deuterium_diff":case"energy_diff":case"sys_expeditions_diff":case"sys_colonies_diff":b+="</th>";break}return b}function eco_struc_show_unit_info(d,m){if(!m){$("#unit"+d).addClass("unit_border_selected")}if(unit_selected){return}$("#unit_id").val(d);$("#unit_amountslide").slider({value:0,max:0});var k=production[d];var n="";var h="";var e=$("#unit_info_image");e.attr("src",k.image);$("#unit_info_wiki").attr("unit_id",d);$("#unit_info_description").html(k.description);$("#unit_time").html(k.time);$("#unit_time_div").css("display",k.time_seconds?"block":"none");$("#unit_info_name").html(k.name);if(k.level>0||STACKABLE){$("#unit_info_level").html((!STACKABLE?language.level+" ":"")+k.level+(Math.intVal(k.level_bonus)?'<span class="bonus">+'+k.level_bonus+"</span>":""))}else{$("#unit_info_level").html("&nbsp;")}if(STACKABLE){$("#unit_max").show();$("#unit_max_number").html(sn_format_number(k.can_build));$("#unit_max_number_autoconvert").html(sn_format_number(k.autoconvert_amount))}$("#unit_create, #unit_create *").prop("disabled",true);$("#unit_create_button").button("disable");$("#unit_destroy").css("visibility","hidden");var f;if(require[d]){requirement_string="";for(c in require[d]){f=require[d][c];requirement_string=requirement_string+'<li class="'+(f.requerements_met?"positive":"negative  ")+'">'+f.name+(!isNaN(f.level_basic)?" "+f.level_basic+(f.level_bonus?'<span class="bonus">+'+f.level_bonus+"</span>":"")+"/"+f.level_require:"")+"</li>"}$("#unit_require").empty().append(requirement_string);$("#unit_require_wrapper").show()}else{$("#unit_require_wrapper").hide()}if(grants[d]){requirement_string="";for(c in grants[d]){f=grants[d][c];requirement_string=requirement_string+'<li class="'+(f.requerements_met?"positive":"negative  ")+'">'+f.name+(!isNaN(f.level_basic)?" "+f.level_basic+(f.level_bonus?'<span class="bonus">+'+f.level_bonus+"</span>":"")+"/"+f.level_require:"")+"</li>"}$("#unit_grants").empty().append(requirement_string);$("#unit_grants_wrapper").show()}else{$("#unit_grants_wrapper").hide()}if(TEMPORARY){$("#unit_cost_table").hide()}else{$("#unit_cost_table").css("display","table");eco_struc_make_resource_rows_all(k);if(planet.que_has_place!=0&&!k.unit_busy){if(STACKABLE){$("#auto_convert").change();if(k.build_can!=0&&k.build_result==0){$("#unit_create, #unit_create *").prop("disabled",false);$("#unit_amountslide").slider({max:k.can_build})}}else{if(k.level>0&&k.destroy_can!=0&&k.destroy_result==0){$("#unit_destroy").css("visibility","visible");$("#unit_destroy_level").html(k.level);$("#unit_destroy_resources").html((k.destroy_metal?language.sys_metal[0]+": "+sn_format_number(k.destroy_metal,0,"positive")+" ":"")+(k.destroy_crystal?language.sys_crystal[0]+": "+sn_format_number(k.destroy_crystal,0,"positive")+" ":"")+(k.destroy_deuterium?language.sys_deuterium[0]+":"+sn_format_number(k.destroy_deuterium,0,"positive")+" ":""));$("#unit_destroy_time").html(k.destroy_time)}if(planet.fields_free>0&&k.build_can!=0&&k.build_result==0){$("#unit_create_button").button("enable");$("#unit_create, #unit_create *").prop("disabled",false)}}}}$("#unit_create_button_auto").button(k.can_autoconvert?"enable":"disable").prop("disabled",k.can_autoconvert?false:true);$("#unit_create_level, #unit_create_level_auto").html(k.level+1);var c,b,a;n="";if(k.resource_map){var g="";if(STACKABLE){for(c in k.resource_map[0]){if(!k.resource_map[0].hasOwnProperty(c)){continue}if(k.resource_map[0][c]){n+="<tr>";n+='<th class="c_l">'+language[c]+"</th>";n+='<td class="c_r">'+k.resource_map[0][c]+"</td>";n+="</tr>"}}}else{var l=false;for(c in k.resource_map){if(!k.resource_map.hasOwnProperty(c)){continue}n+='<tr class="c_r">';for(b in k.resource_map[c]){if(!k.resource_map[c].hasOwnProperty(b)||!k.resource_map[c][b]){continue}if(!l){g=extracted(b,g)}a=b=="level"?-k.level-k.level_bonus:(b.indexOf("diff")==-1?(k.resource_map[c-1]?-k.resource_map[c-1][b]:0):0);n+="<td>"+sn_format_number(Math.floatVal(k.resource_map[c][b]),0,"positive",a,k.resource_map[c][b]>0&&b.indexOf("diff")>=0)+"</td>"}n+="</tr>";l=true}}n?n=(g?"<tr>"+g+"</tr>":"")+n:false}!n?n='<tr><th class="c_c">'+language.eco_bld_unit_info_extra_none+"</th></tr>":false;$("#unit_balance").html('<table class="border_image_small">'+n+"</table>");$("<style></style>").appendTo($(document.body)).remove()}function eco_struc_select_unit(a){$("#unit_id").val(a);if(unit_selected==a){unit_selected=null}else{if(unit_selected){$("#unit"+unit_selected).removeClass("unit_border_selected");unit_selected=null;eco_struc_show_unit_info(a)}unit_selected=a;$("#unit_amountslide").slider({value:0})}}$(document).on("click","#eco_que_clear",function(a){snConfirm({that:$(this),message:language.eco_que_clear_dialog_text,title:language.eco_que_clear_dialog_title});return false});$(document).on("click","#eco_que_artifact",function(a){snConfirm({that:$(this),message:language.eco_que_artifact_dialog_text.format($(this).text()),title:language.eco_que_artifact_dialog_title.format($(this).text())});return false});