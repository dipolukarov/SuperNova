var eco_mrk_trader_recalc_lock=false;function eco_mrk_trader_recalc(){if(eco_mrk_trader_recalc_lock){return}selected_resource_id=parseInt($("input:radio[name=exchangeTo]:checked").val());var f=0;var e=false;var b=$("#spend"+selected_resource_id);var g=parseFloat(b.val());!(g)?g=0:false;var d,a;for(var c in eco_market_resources){if(!eco_market_resources.hasOwnProperty(c)){continue}d=$("#spend"+c);!(a=parseFloat(d.val()))?a=0:false;if((selected_resource_id!=RES_DARK_MATTER&&c==selected_resource_id)||(selected_resource_id==RES_DARK_MATTER&&c!=RES_DARK_MATTER)){d.addClass("ok_bg");jQuery('[id^="spend'+c+'"]').prop("disabled",true);jQuery("#spend"+c+"slide").slider("disable")}else{jQuery('[id^="spend'+c+'"]').prop("disabled",false);jQuery("#spend"+c+"slide").slider("enable");if(a>eco_market_resources[c]["avail"]){d.addClass("error_bg");e=true}else{d.removeClass("ok_bg").removeClass("error_bg")}}if(selected_resource_id==RES_DARK_MATTER&&c!=RES_DARK_MATTER){a=-parseFloat(g/3/eco_market_resources[c]["rate"]*eco_market_resources[selected_resource_id]["rate"])}if(selected_resource_id!=RES_DARK_MATTER&&c!=selected_resource_id){f+=Math.floor(parseFloat(a*eco_market_resources[c]["rate"]/eco_market_resources[selected_resource_id]["rate"]))}a=Math.floor(a);$("#res_left"+c).html(sn_format_number(eco_market_resources[c]["avail"]-a));$("#res_delta"+c).html(sn_format_number(-a,0,"positive",0,true));d.val(Math.abs(a))}if(selected_resource_id==RES_DARK_MATTER){$("#res_delta"+selected_resource_id).html(sn_format_number(-g,0,"positive",0,true));$("#res_left"+selected_resource_id).html(sn_format_number(eco_market_resources[selected_resource_id]["avail"]-g));e=e||!g}else{b.val(f);$("#res_delta"+selected_resource_id).html(sn_format_number(f,0,"positive",0,true));$("#res_left"+selected_resource_id).html(sn_format_number(eco_market_resources[selected_resource_id]["avail"]+f));e=e||!f}$("#submit_trade").prop("disabled",e)}function eco_mrk_trader_recourse(b){var e,d;b=parseInt(b);$("#market_trader").find(".button_pseudo").removeClass("button_pseudo_pressed");$("[resource_id="+b+"]").addClass("button_pseudo_pressed");$("input:radio[name=exchangeTo]").val([b]);var c=eco_market_resources[b]["rate"];eco_mrk_trader_recalc_lock=true;for(var a in eco_market_resources){if(!eco_market_resources.hasOwnProperty(a)){continue}d=eco_market_resources[a]["rate"]/c;b==RES_DARK_MATTER?d="1 : "+(1/d):(d+=" : 1");$("#course"+a).html(d);jQuery("#spend"+a+"slide").slider("value",0)}e=C_rpg_cost_trader*(b==RES_DARK_MATTER?3:1);eco_market_resources[RES_DARK_MATTER]["avail"]=eco_market_resources[RES_DARK_MATTER]["start"]-e;$("#rpg_cost_trader").html(e);eco_mrk_trader_recalc_lock=false;eco_mrk_trader_recalc()}$(document).on("click","#submit_trade",function(){var a=true,b;if(b=parseFloat(jQuery("#spend"+RES_DARK_MATTER).val())){a=window.confirm(language.LA_eco_mrk_trader_exchange_dm_confirm.format(sn_format_number(b)))}if(a){$(this).prop("disabled",true);$("#form_trade").submit()}return a});jQuery(document).on("click","#market_trader .button_pseudo",function(){eco_mrk_trader_recourse($(this).attr("resource_id"))});jQuery(document).ready(function(){if($("#market_trader").length){eco_mrk_trader_recourse(exchange_to_resource_id?exchange_to_resource_id:RES_METAL)}});