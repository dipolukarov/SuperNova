function fenster(b,a){var c=window.open(b,a,"resizable=yes,scrollbars=yes,menubar=no,toolbar=no,width=640,height=480,top=0,left=0");c.focus()}function universe_popup_show(a){if($(a.of).attr("popup_opened_here")){popup_hide()}else{popup_show(a.html,a);$(a.of).attr("popup_opened_here",1)}}var universe_popup;function sn_universe_show_planet(f){var e=f.parents(".uni_planet_row");var g=e.attr("planet_pos");var b=f.attr("planet_type");if(!uni_row[g]||!b||(b==3&&!parseInt(uni_row[g]["moon_diameter"]))||parseInt(uni_row[g]["planet_destroyed"])){return}var d=uni_row[g]["owner"]==user_id;var c=b==1?"planet":"moon";var a=jQuery("#planet_template").html().replace(/\[PLANET_POS\]/g,g).replace(/\[PLANET_TYPE\]/g,b).replace(/\[PLANET_TYPE_TEXT\]/g,language[b==1?"sys_planet":"sys_moon"]).replace(/\[PLANET_TYPE_TEXT_SHORT\]/g,language["sys_"+c+"_short"]).replace(/\[PLANET_NAME\]/g,uni_row[g][c+"_name"]).replace(/\[PLANET_IMAGE\]/g,uni_row[g][c+"_image"]).replace(/\[PLANET_DIAMETER\]/g,uni_row[g][c+"_diameter"]).replace(/\[FLEET_TABLE\]/g,fleet_table_make(uni_row[g][c+"_fleet_id"])).replace(/\[HIDE_PLANET_PHALANX\]/g,!d&&uni_phalanx&&b==1?"":"display: none;").replace(/\[HIDE_PLANET_MISSILE\]/g,!d&&window.uni_missiles&&b==1?"":"display: none;").replace(/\[HIDE_PLANET_DESTROY\]/g,!d&&parseFloat(uni_death_stars)&&b==3?"":"display: none;").replace(/\[HIDE_PLANET_RELOCATE\]/g,d?"":"display: none;").replace(/\[HIDE_PLANET_SPY\]/g,d?"display: none;":"").replace(/\[HIDE_PLANET_ATTACK\]/g,d?"display: none;":"").replace(/\[HIDE_PLANET_HOLD\]/g,d?"display: none;":"");return{html:a,my:b==3?"left middle":"right middle",at:b==3?"right middle":"left middle",of:f}}function sn_universe_show_debris(c){var b=c.parents(".uni_planet_row");var e=b.attr("planet_pos");if(!uni_row[e]||!parseFloat(uni_row[e]["debris"])){return}var d=Math.round(uni_row[e]["debris_metal"]/uni_row[e]["debris"]*100);var a=jQuery("#debris_template").html().replace(/\[CURRENT_PLANET\]/g,e).replace("[DEBRIS]",sn_format_number(uni_row[e]["debris"])).replace("[DEBRIS_METAL]",sn_format_number(uni_row[e]["debris_metal"])).replace("[DEBRIS_METAL_PERCENT]",d).replace("[DEBRIS_CRYSTAL]",sn_format_number(uni_row[e]["debris_crystal"])).replace("[DEBRIS_CRYSTAL_PERCENT]",100-d).replace("[DEBRIS_GATHER_TOTAL]",sn_format_number(uni_row[e]["debris_gather_total"])).replace("[DEBRIS_GATHER_TOTAL_PERCENT]",sn_format_number(uni_row[e]["debris_gather_total_percent"])).replace("[DEBRIS_RESERVED]",sn_format_number(uni_row[e]["debris_reserved"])).replace("[DEBRIS_RESERVED_PERCENT]",sn_format_number(uni_row[e]["debris_reserved_percent"])).replace("[DEBRIS_WILL_GATHER]",sn_format_number(uni_row[e]["debris_will_gather"])).replace("[DEBRIS_WILL_GATHER_PERCENT]",sn_format_number(uni_row[e]["debris_will_gather_percent"])).replace("[HIDE_RECYCLER_LINK]",PLANET_RECYCLERS>0&&parseFloat(uni_row[e]["debris_will_gather"])?"":"display: none;");return{html:a,my:"middle bottom",at:"middle top",of:c}}function sn_universe_show_user(d){var c=d.parents(".uni_planet_row");var b=c.attr("user_id");if(!b||!users[b]){return}var a=jQuery("#user_template").html().replace(/\[USER_ID\]/g,b).replace(/\[USER_NAME\]/g,users[b]["name"]).replace(/\[USER_RANK\]/g,users[b]["rank"]).replace(/\[HIDE_USER_AVATAR\]/g,opt_uni_avatar_user&&users[b]["avatar"]==1?"":"display: none;").replace(/\[USER_COLSPAN]/g,opt_uni_avatar_user&&users[b]["avatar"]==1?2:1).replace(/\[USER_ALLY_TAG\]/g,users[b]["ally_tag"]).replace(/\[USER_ALLY_NAME\]/g,allies[users[b]["ally_id"]]?allies[users[b]["ally_id"]]["name"]:"").replace(/\[USER_ALLY_TITLE\]/g,users[b]["ally_title"]).replace(/\[HIDE_USER_ALLY\]/g,users[b]["ally_title"]&&users[b]["ally_title"]!==undefined?"":"display: none;");return{html:a,my:"left middle",at:"right middle",of:d}}function sn_universe_show_ally(d){var c=d.parents(".uni_planet_row");var b=c.attr("ally_id");if(!b||!allies[b]){return}var a=jQuery("#ally_template").html().replace(/\[ALLY_ID\]/g,b).replace(/\[ALLY_NAME\]/g,allies[b]["name"]).replace(/\[ALLY_RANK\]/g,allies[b]["rank"]).replace(/\[ALLY_MEMBERS\]/g,allies[b]["members"]).replace(/\[HIDE_ALLY_AVATAR\]/g,opt_uni_avatar_ally&&allies[b]["avatar"]==1?"":"display: none;").replace(/\[ALLY_COLSPAN]/g,opt_uni_avatar_ally&&allies[b]["avatar"]==1?2:1).replace(/\[ALLY_URL\]/g,allies[b]["url"]).replace(/\[HIDE_ALLY_URL\]/g,allies[b]["url"]?"":"display: none");return{html:a,my:"left top",at:"right top",of:d}}$(function(){$(document).on("click mouseenter","#universe_legend",function(){popup_show(jQuery("#legend_template").html(),{my:"right top",at:"right bottom",of:this})});$(document).on("mouseleave","#universe_legend",function(){universe_popup=null});$(document).on("mouseleave",".uni_show_planet,.uni_show_debris,.uni_show_user,.uni_show_ally",function(){universe_popup=null});$(document).on("click mouseenter",".uni_show_planet,.uni_show_debris,.uni_show_user,.uni_show_ally",function(a){that=$(this);universe_popup=that;sn_delay(function(b){if(b!=universe_popup){return false}result=false;switch(true){case b.hasClass("uni_show_planet"):result=sn_universe_show_planet(b);break;case b.hasClass("uni_show_debris"):result=sn_universe_show_debris(b);break;case b.hasClass("uni_show_user"):result=sn_universe_show_user(b);break;case b.hasClass("uni_show_ally"):result=sn_universe_show_ally(b);break}if(result){universe_popup_show(result)}},a.type=="mouseenter"?opt_uni_tooltip_time:1,that)})});$(document).on("click",".planet_template .ownmissile, .missile_attack_prepare",function(){popup_hide();uni_missile_planet=attr_on_me_or_parent(this,"planet_planet");jQuery("#uni_missile_planet").html(uni_missile_planet);jQuery("#uni_missile_form").show();$("html, body").animate({scrollTop:$("#uni_missile_form").offset().top},2000)});$(document).on("click",".debris_template .ownharvest",function(){popup_hide();doit(MT_RECYCLE,$(this).attr("planet_planet"),PT_DEBRIS)});$(document).on("click","#galaxyLeft",function(){$("#galaxy").val((parseInt($("#galaxy").val())?parseInt($("#galaxy").val()):0)-1);$("#galaxy_form").submit()});$(document).on("click","#galaxyRight",function(){$("#galaxy").val((parseInt($("#galaxy").val())?parseInt($("#galaxy").val()):0)+1);$("#galaxy_form").submit()});$(document).on("click","#systemLeft",function(){$("#system").val((parseInt($("#system").val())?parseInt($("#system").val()):0)-1);$("#galaxy_form").submit()});$(document).on("click","#systemRight",function(){$("#system").val((parseInt($("#system").val())?parseInt($("#system").val()):0)+1);$("#galaxy_form").submit()});