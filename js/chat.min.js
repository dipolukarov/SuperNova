var chat_refreshing=false;var chat_last_message=0;function addSmiley(a){document.chat_form.msg.value+=a;document.chat_form.msg.focus()}function addMessage(){var b=document.chat_form.msg.value;if(!b){return}document.chat_form.msg.value="";var a=document.getElementById("chat_color");a=a.options[a.selectedIndex].value;if(a){b="[c="+a+"]"+b+"[/c]"}jQuery.post("index.php?page=chat_add",{ally:ally_id,message:b},function(c){showMessage()})}function showMessage(a){if(chat_refreshing){return}chat_refreshing=true;jQuery.post("index.php?page=chat_msg",{page:"chat_msg",ally:ally_id,last_message:chat_last_message},function(c){var b=document.getElementById("shoutbox");if(c.html){chat_last_message=c.last_message;b.innerHTML+=c.html;jQuery("#shoutbox").animate({scrollTop:jQuery("#shoutbox").prop("scrollHeight")},2000);if(a!==true){sn_sound_play("chat_message")}}if(c.disable!=undefined){jQuery("#msg,#send,#chat_color").attr("disabled","disabled");jQuery("#chat_message_inputs, #chat_message_smiles").hide()}else{chat_refreshing=false;window.setTimeout(showMessage,5000)}},"json")}jQuery(document).ready(function(){showMessage(true)});